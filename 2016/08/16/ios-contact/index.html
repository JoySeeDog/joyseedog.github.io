<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="iOS开发进阶-Contacts/ContactUI学习和使用"/>




  <meta name="keywords" content="iOS开发进阶,CNContacts,CNContactsUI," />




  <link rel="alternate" href="/default" title="See me like see you">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.4.x" />



<link rel="canonical" href="http://www.iseedog.com/2016/08/16/ios-contact/"/>


<meta name="description" content="Contacts FrameWork是苹果推出的新联系人框架。应用于iOS 9.0之后，9.0之后将会全面取代Address Book 。用过Address Book的开发者都应该能理解苹果为何要弃用它了。一方面对于开发者实在不是很友好，语法怪怪的。另一方面，作者猜测可能是线程安全方面做得不够好，所以苹果打算有所改进。本文将阐述Contacts和ContactsUI的基本原理和基本用法。">
<meta name="keywords" content="iOS开发进阶,CNContacts,CNContactsUI">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS开发进阶-Contacts&#x2F;ContactUI学习和使用">
<meta property="og:url" content="http://www.iseedog.com/2016/08/16/ios-contact/index.html">
<meta property="og:site_name" content="See me like see you">
<meta property="og:description" content="Contacts FrameWork是苹果推出的新联系人框架。应用于iOS 9.0之后，9.0之后将会全面取代Address Book 。用过Address Book的开发者都应该能理解苹果为何要弃用它了。一方面对于开发者实在不是很友好，语法怪怪的。另一方面，作者猜测可能是线程安全方面做得不够好，所以苹果打算有所改进。本文将阐述Contacts和ContactsUI的基本原理和基本用法。">
<meta property="og:image" content="http://img.blog.csdn.net/20160816115907206">
<meta property="og:image" content="http://img.blog.csdn.net/20160816143827464">
<meta property="og:image" content="http://img.blog.csdn.net/20160816144458389">
<meta property="og:image" content="http://img.blog.csdn.net/20160816154629703">
<meta property="og:updated_time" content="2017-03-20T15:51:55.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS开发进阶-Contacts&#x2F;ContactUI学习和使用">
<meta name="twitter:description" content="Contacts FrameWork是苹果推出的新联系人框架。应用于iOS 9.0之后，9.0之后将会全面取代Address Book 。用过Address Book的开发者都应该能理解苹果为何要弃用它了。一方面对于开发者实在不是很友好，语法怪怪的。另一方面，作者猜测可能是线程安全方面做得不够好，所以苹果打算有所改进。本文将阐述Contacts和ContactsUI的基本原理和基本用法。">
<meta name="twitter:image" content="http://img.blog.csdn.net/20160816115907206">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.4.x" />







<script>
  var CONFIG = {
    search: false,
    searchPath: "/search.xml",
    fancybox: false,
    toc: true,
  }
</script>




  

  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-98500916-1', 'auto');
        ga('send', 'pageview');
  </script>



    <title> iOS开发进阶-Contacts/ContactUI学习和使用 · See me like see you </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">See me like see you</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            Tags
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            Categories
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">See me like see you</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              Home
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              Archives
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              Tags
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              Categories
            
          </a>
        </li>
      
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          iOS开发进阶-Contacts/ContactUI学习和使用
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Aug 16, 2016
        </span>
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Contacts"><span class="toc-text">Contacts</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#联系人对象"><span class="toc-text">联系人对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#学习相关API"><span class="toc-text">学习相关API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实际运用"><span class="toc-text">实际运用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#获取授权信息"><span class="toc-text">获取授权信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Contact"><span class="toc-text">Contact</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Group"><span class="toc-text">Group</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#格式化"><span class="toc-text">格式化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#本地化"><span class="toc-text">本地化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#部分联系方式"><span class="toc-text">部分联系方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ContactsUI"><span class="toc-text">ContactsUI</span></a></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <p>Contacts FrameWork是苹果推出的新联系人框架。应用于iOS 9.0之后，9.0之后将会全面取代<code>Address Book</code> 。用过<code>Address Book</code>的开发者都应该能理解苹果为何要弃用它了。一方面对于开发者实在不是很友好，语法怪怪的。另一方面，作者猜测可能是线程安全方面做得不够好，所以苹果打算有所改进。本文将阐述<code>Contacts</code>和<code>ContactsUI</code>的基本原理和基本用法。</p>
<a id="more"></a>
<h1 id="Contacts"><a href="#Contacts" class="headerlink" title="Contacts"></a>Contacts</h1><p>因为大部分的App都只是需要读取联系人信息而不需要做修改，因此<code>Contacts</code>只能读取，同时它的线程安全得到很好的保障。</p>
<hr>
<h2 id="联系人对象"><a href="#联系人对象" class="headerlink" title="联系人对象"></a>联系人对象</h2><p><img src="http://img.blog.csdn.net/20160816115907206" alt="这里写图片描述"></p>
<p><code>Contact</code>类是线程安全的,联系人的属性是不可以改变的,比如联系人的名称,图片,或者电话号码。这个类有点像<code>NSDictionary</code>，里面存了各种类型的东西。和<code>MutableDictionary</code>很类似，它有一个可变的子类<code>CNMutableContact</code>，可以修改联系人的属性。联系人的某些属性可以有多个值,如电话号码或电子邮件地址,它们都是包含了<code>CNLabeledValue</code>对象数组，<code>CNLabeledValue</code>是很有意思的一个类，我个人感觉里面主要还是使用了swift的新特性<code>puple</code>中文叫做元组。元组和数组类似，只不过里面数组的元素类型可以是不同的。一个<code>CNLabeledValu</code>e对象其实就是包含了一个Label和一个Value的线程安全的不可变元组。每个Label描述了每个Value的使用者。比如电话号码，家庭号码和工作号码都是不同的Label。苹果已经提供了很多实用的标签，如果开发者觉得不够用也可以自己定义，我个人感觉够用了。</p>
<hr>
<h2 id="学习相关API"><a href="#学习相关API" class="headerlink" title="学习相关API"></a>学习相关API</h2><p>首先了解一下头文件中包含的相关类。头文件集中在<code>&lt;Contacts/Contacts.h&gt;</code>, 我们依次过一遍相关的API。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#import &lt;Contacts/CNLabeledValue.h&gt;</div><div class="line">#import &lt;Contacts/CNPhoneNumber.h&gt;</div><div class="line">#import &lt;Contacts/CNPostalAddress.h&gt;</div><div class="line">#import &lt;Contacts/CNMutablePostalAddress.h&gt;</div><div class="line">#import &lt;Contacts/CNInstantMessageAddress.h&gt;</div><div class="line">#import &lt;Contacts/CNSocialProfile.h&gt;</div><div class="line">#import &lt;Contacts/CNContactRelation.h&gt;</div></pre></td></tr></table></figure>
<p><code>CNLabeledValue</code>是一个泛型的类，可以使用如下方法直接返回一个<code>CNLabeledValue</code>类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ (instancetype)labeledValueWithLabel:(nullable NSString *)label value:(ValueType)value;</div></pre></td></tr></table></figure></p>
<p><code>CNContact</code>里面的属性都是以<code>CNLabeledValue</code>，或是<code>CNLabeledValue</code>数组的形式存在。如果实在难以理解<code>CNLabeledValue</code>到底是什么，可以把它当作一个字典，Label类似于key，Value类似于字典里面的Value。然后联系人属性都是存储字典或是字典数组。<br><code>CNPhoneNumber</code>是电话号码类，主要包括了一个属性就是号码，至于到底是家庭号码还是工作号码 需要根据Label区分。<br><code>CNPostalAddress</code>和<code>CNMutablePostalAddress</code>是邮寄地址也就是联系人地址。<br><code>CNSocialProfile</code>是社会化组件信息，比如FaceBook，微博这些<br><code>CNInstantMessageAddress</code>是即时通讯信息，比如QQ这些。<br> <code>CNContactRelation</code>是联系人关系信息。<br>我们点其中任何一个类的头文件开会发现里面有很多类似如下的定义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberiPhone                NS_AVAILABLE(10_11, 9_0);</div><div class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberMobile                NS_AVAILABLE(10_11, 9_0);</div><div class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberMain                  NS_AVAILABLE(10_11, 9_0);</div><div class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberHomeFax               NS_AVAILABLE(10_11, 9_0);</div><div class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberWorkFax               NS_AVAILABLE(10_11, 9_0);</div><div class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberOtherFax              NS_AVAILABLE(10_11, 9_0);</div><div class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberPager</div></pre></td></tr></table></figure>
<p>他们是用于操作这些信息的Label，或是Key，用到什么再去找具体的就好。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#import &lt;Contacts/CNContact.h&gt;</div><div class="line">#import &lt;Contacts/CNContact+Predicates.h&gt;</div><div class="line">#import &lt;Contacts/CNMutableContact.h&gt;</div></pre></td></tr></table></figure>
<p><code>CNContact</code>和<code>CNMutableContact</code>不用多说，是系统用于存储联系人信息类。<code>CNContact+Predicates</code>是用于联系人过滤筛选的类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#import &lt;Contacts/CNContactStore.h&gt;</div><div class="line">#import &lt;Contacts/CNContactFetchRequest.h&gt;</div><div class="line">#import &lt;Contacts/CNSaveRequest.h&gt;</div></pre></td></tr></table></figure>
<p>看三个类是不是和<code>CoreData</code>里面操作数据库的类很像，这三个类主要就是用于联系人信息的增删改查等等相关操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#import &lt;Contacts/CNGroup.h&gt;</div><div class="line">#import &lt;Contacts/CNGroup+Predicates.h&gt;</div><div class="line">#import &lt;Contacts/CNMutableGroup.h&gt;</div><div class="line"></div><div class="line">#import &lt;Contacts/CNContainer.h&gt;</div><div class="line">#import &lt;Contacts/CNContainer+Predicates.h&gt;</div></pre></td></tr></table></figure>
<p>分组和容器类。一个用户可能在本地或是服务器都有联系人，每个账户至少都有一个容器，每个联系人只可能在一个容器中。<br><img src="http://img.blog.csdn.net/20160816143827464" alt="这里写图片描述"></p>
<p>组是容器里面的一个联系人集合，并不是所有的容器都支持组合子分组。比如iCloud账户只有一个容器不过有很多个组和分组。但是一个外汇账户不允许有很多个分组，不过会有很多容器。<br><img src="http://img.blog.csdn.net/20160816144458389" alt="这里写图片描述"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#import &lt;Contacts/CNContactFormatter.h&gt;</div><div class="line">#import &lt;Contacts/CNPostalAddressFormatter.h&gt;</div></pre></td></tr></table></figure>
<p>以上两个类主要是用于格式化姓名电话号码和地址，比如可以格式化为全名、全部地址等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#import &lt;Contacts/CNContactVCardSerialization.h&gt;</div><div class="line">#import &lt;Contacts/CNContactsUserDefaults.h&gt;</div><div class="line">#import &lt;Contacts/CNContactProperty.h&gt;</div><div class="line">#import &lt;Contacts/CNError.h&gt;</div></pre></td></tr></table></figure>
<p><code>CNContactVCardSerialization</code>用于序列化电子名片，<code>CNContactsUserDefaults</code>用于用户默认的设置，<code>CNContactProperty</code>是获取单个属性。</p>
<hr>
<h2 id="实际运用"><a href="#实际运用" class="headerlink" title="实际运用"></a>实际运用</h2><h3 id="获取授权信息"><a href="#获取授权信息" class="headerlink" title="获取授权信息"></a>获取授权信息</h3><p> 在进行电话本相关操作的时候最好是先进行相关的权限判断。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"> CNContactStore * contactStore = [[CNContactStore alloc]init];</div><div class="line"></div><div class="line">if ([CNContactStore authorizationStatusForEntityType:CNEntityTypeContacts] == CNAuthorizationStatusNotDetermined) &#123;</div><div class="line">    [contactStore requestAccessForEntityType:CNEntityTypeContacts completionHandler:^(BOOL granted, NSError * __nullable error) &#123;</div><div class="line">        if (granted==YES) &#123;</div><div class="line">            //执行相关操作</div><div class="line">            if ([self addContactInIOS9andLower]) &#123;</div><div class="line">                NSLog(@&quot;Error&quot;);</div><div class="line">            &#125;</div><div class="line">            else&#123;</div><div class="line">                NSLog(@&quot;Error&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        else&#123;</div><div class="line">            NSLog(@&quot;Error&quot;);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;];</div><div class="line"></div><div class="line">&#125;</div><div class="line">else if ([CNContactStore authorizationStatusForEntityType:CNEntityTypeContacts] == CNAuthorizationStatusAuthorized)&#123;</div><div class="line">    //执行相关操作</div><div class="line">&#125;</div><div class="line">else &#123;</div><div class="line">    NSLog(@&quot;Error&quot;);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Contact"><a href="#Contact" class="headerlink" title="Contact"></a>Contact</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">// 创建联系人对象</div><div class="line"> CNMutableContact *contact = [[CNMutableContact alloc] init];</div><div class="line"> // 设置联系人的头像</div><div class="line"> contact.imageData = UIImagePNGRepresentation([UIImage imageNamed:@&quot;animal&quot;]);</div><div class="line"> </div><div class="line"> // 设置联系人姓名</div><div class="line"> contact.givenName = @&quot;测试&quot;;</div><div class="line"> // 设置姓氏</div><div class="line"> contact.familyName = @&quot;测试&quot;;</div><div class="line"> </div><div class="line"> // 设置联系人邮箱</div><div class="line"> CNLabeledValue *homeEmail = [CNLabeledValue labeledValueWithLabel:CNLabelHome value:@&quot;12345qq.com&quot;];</div><div class="line"> CNLabeledValue *workEmail = [CNLabeledValue labeledValueWithLabel:CNLabelWork value:@&quot;32467@sina.cn&quot;];</div><div class="line"> CNLabeledValue *otherEmail = [CNLabeledValue labeledValueWithLabel:CNLabelOther value:@&quot;l111.com&quot;];</div><div class="line"> contact.emailAddresses = @[homeEmail,workEmail,otherEmail];</div><div class="line"> </div><div class="line"> // 设置机构名</div><div class="line"> contact.organizationName = @&quot;iOS&quot;;</div><div class="line"> // 设置部门</div><div class="line"> contact.departmentName = @&quot;移动&quot;;</div><div class="line"> // 设置工作的名称</div><div class="line"> contact.jobTitle = @&quot;ios&quot;;</div><div class="line"> </div><div class="line"> // 设置社交组件</div><div class="line"> CNSocialProfile *profile = [[CNSocialProfile alloc] initWithUrlString:@&quot;22222222.cn&quot; username:@&quot;Test&quot; userIdentifier:nil service:@&quot;IT行业&quot;];</div><div class="line"> CNLabeledValue *socialProfile = [CNLabeledValue labeledValueWithLabel:CNSocialProfileServiceGameCenter value:profile];</div><div class="line"> contact.socialProfiles = @[socialProfile];</div><div class="line"> </div><div class="line"> // 设置电话号码</div><div class="line"> CNPhoneNumber *mobileNumber = [[CNPhoneNumber alloc] initWithStringValue:@&quot;15201596724&quot;];</div><div class="line"> CNLabeledValue *mobilePhone = [[CNLabeledValue alloc] initWithLabel:CNLabelPhoneNumberMobile value:mobileNumber];</div><div class="line"> contact.phoneNumbers = @[mobilePhone];</div><div class="line"> </div><div class="line"> // 设置与联系人的关系</div><div class="line"> CNContactRelation *friend = [[CNContactRelation alloc] initWithName:@&quot;好朋友&quot;];</div><div class="line"> CNLabeledValue *relation = [CNLabeledValue labeledValueWithLabel:CNLabelContactRelationFriend value:friend];</div><div class="line"> contact.contactRelations = @[relation];</div><div class="line"> </div><div class="line"> // 设置生日</div><div class="line"> NSDateComponents *birthday = [[NSDateComponents alloc] init];</div><div class="line"> birthday.day = 6;</div><div class="line"> birthday.month = 5;</div><div class="line"> birthday.year = 2000;</div><div class="line"> contact.birthday = birthday;</div></pre></td></tr></table></figure>
<p>联系人创建完毕，我们可以添加联系人</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (void)addContact:(CNMutableContact *)contact&#123;</div><div class="line">    // 创建联系人请求</div><div class="line">    CNSaveRequest *saveRequest = [[CNSaveRequest alloc] init];</div><div class="line">    [saveRequest addContact:contact toContainerWithIdentifier:nil];</div><div class="line">    // 写入联系人</div><div class="line">    CNContactStore *store = [[CNContactStore alloc] init];</div><div class="line">    [store executeSaveRequest:saveRequest error:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>删除联系人</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (void)deleteContact:(CNMutableContact *)contact&#123;</div><div class="line">    // 创建联系人请求</div><div class="line">    CNSaveRequest *saveRequest = [[CNSaveRequest alloc] init];</div><div class="line">    [saveRequest deleteContact:contact];</div><div class="line">    // 写入操作</div><div class="line">    CNContactStore *store = [[CNContactStore alloc] init];</div><div class="line">    [store executeSaveRequest:saveRequest error:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>更新联系人</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (void)updateContact:(CNMutableContact *)contact&#123;</div><div class="line">    // 创建联系人请求</div><div class="line">    CNSaveRequest *saveRequest = [[CNSaveRequest alloc] init];</div><div class="line">    [saveRequest updateContact:contact];</div><div class="line">    // 重新写入</div><div class="line">    CNContactStore *store = [[CNContactStore alloc] init];</div><div class="line">    [store executeSaveRequest:saveRequest error:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>查询联系人</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (NSArray *)queryContactWithName:(NSString *)name&#123;</div><div class="line">    </div><div class="line">    CNContactStore *store = [[CNContactStore alloc] init];</div><div class="line">    //检索条件</div><div class="line">    NSPredicate *predicate = [CNContact predicateForContactsMatchingName:name];</div><div class="line">    </div><div class="line">    //过滤的条件，也可以过滤时候格式化</div><div class="line">    NSArray *keysToFetch = @[CNContactEmailAddressesKey, [CNContactFormatter descriptorForRequiredKeysForStyle:CNContactFormatterStyleFullName]];</div><div class="line">    </div><div class="line">    NSArray *contact = [store unifiedContactsMatchingPredicate:predicate keysToFetch:keysToFetch error:nil];</div><div class="line">    return contact;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>keysToFetch</code>是表明从这些属性里面过滤。<code>[CNContactFormatter descriptorForRequiredKeysForStyle:CNContactFormatterStyleFullName]</code>格式化姓名，输出全名作为过滤条件。</p>
<h3 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h3><p>添加一个Group<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (void)addGroupWithName:(NSString *)name&#123;</div><div class="line">    CNMutableGroup *group = [[CNMutableGroup alloc] init];</div><div class="line">    group.name = name;</div><div class="line">    CNSaveRequest *saveRequest = [[CNSaveRequest alloc] init];</div><div class="line">    [saveRequest addGroup:group toContainerWithIdentifier:nil];</div><div class="line">    // 写入</div><div class="line">    CNContactStore *store = [[CNContactStore alloc] init];</div><div class="line">    [store executeSaveRequest:saveRequest error:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>更新Group<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (void)updateGroup:(CNMutableGroup *)group&#123;</div><div class="line">    CNSaveRequest *saveRequest = [[CNSaveRequest alloc] init];</div><div class="line">    [saveRequest updateGroup:group];</div><div class="line">    // 写入</div><div class="line">    CNContactStore *store = [[CNContactStore alloc] init];</div><div class="line">    [store executeSaveRequest:saveRequest error:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>删除Group<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (void)deleteWithGroup:(CNMutableGroup *)group&#123;</div><div class="line">    CNSaveRequest *saveRequest = [[CNSaveRequest alloc] init];</div><div class="line">    [saveRequest deleteGroup:group];</div><div class="line">    // 写入</div><div class="line">    CNContactStore *store = [[CNContactStore alloc] init];</div><div class="line">    [store executeSaveRequest:saveRequest error:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>group里面添加一个联系人</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (void)addMemberWithContact:(CNContact *)contact toGroup:(CNGroup *)group&#123;</div><div class="line">    CNSaveRequest *saveRequest = [[CNSaveRequest alloc] init];</div><div class="line">    [saveRequest addMember:contact toGroup:group];</div><div class="line">    // 写入</div><div class="line">    CNContactStore *store = [[CNContactStore alloc] init];</div><div class="line">    [store executeSaveRequest:saveRequest error:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从Group删除联系人</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (void)deleteMemberWithContact:(CNContact *)contact toGroup:(CNGroup *)group&#123;</div><div class="line">    CNSaveRequest *saveRequest = [[CNSaveRequest alloc] init];</div><div class="line">    [saveRequest removeMember:contact fromGroup:group];</div><div class="line">    // 写入</div><div class="line">    CNContactStore *store = [[CNContactStore alloc] init];</div><div class="line">    [store executeSaveRequest:saveRequest error:nil];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 填加子分组和删除子分组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (void)addSubgroup:(CNGroup *)subgroup toGroup:(CNGroup *)group NS_AVAILABLE(10_11, NA);</div><div class="line"></div><div class="line">- (void)removeSubgroup:(CNGroup *)subgroup fromGroup:(CNGroup *)group NS_AVAILABLE(10_11, NA);</div></pre></td></tr></table></figure></p>
<h3 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h3><p>有的时候我们想要输出全名或是全部的地址，就可以使用格式化。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">NSString *name =  [CNContactFormatter stringFromContact:contact style:CNContactFormatterStyleFullName];</div><div class="line">     NSLog(@&quot;全名是---%@&quot;,name);</div><div class="line">     </div><div class="line"> NSString *phoneName = [CNContactFormatter stringFromContact:contact style:CNContactFormatterStylePhoneticFullName];</div><div class="line">     NSLog(@&quot;号码全名是---%@&quot;,phoneName);</div><div class="line"></div><div class="line"> NSString *ad = [CNPostalAddressFormatter stringFromPostalAddress:address style:CNPostalAddressFormatterStyleMailingAddress];</div></pre></td></tr></table></figure></p>
<h3 id="本地化"><a href="#本地化" class="headerlink" title="本地化"></a>本地化</h3><p>有时候可能我不知道某个key<code>CNContactFamilyNameKey</code>或是Label 在某个语言里面具体表达的是什么，就可以使用本地化方法来获取对应语言的字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">NSString *disPlayName = [CNContact localizedStringForKey:CNContactFamilyNameKey];</div><div class="line">NSLog(@&quot;CNContactFamilyNameKey---%@&quot;,disPlayName);</div><div class="line">   </div><div class="line">NSString *disPlay = [CNLabeledValue localizedStringForLabel:CNLabelURLAddressHomePage];</div><div class="line">NSLog(@&quot;CNLabelURLAddressHomePage是---%@&quot;,disPlay);</div></pre></td></tr></table></figure>
<h3 id="部分联系方式"><a href="#部分联系方式" class="headerlink" title="部分联系方式"></a>部分联系方式</h3><p>不知我这么翻译准确不准确。苹果的原词是<code>Partial Contacts</code>。要表达的就是某个联系人可能只包含一部分属性，如果你要使用的属性不存在的话就会存在异常，所以在使用属性的时候最好先用<code>isKeyAvailable</code>或是<code>areKeysAvailable</code>去检查一下属性可用不可用。可用的话再使用，否则使用统一查询查询联系人的其他信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">if ([contact isKeyAvailable:CNContactPhoneNumbersKey]) &#123;</div><div class="line">        //使用contact</div><div class="line">    &#125;else &#123;</div><div class="line">        NSArray *keyFetch = @[CNContactGivenNameKey,CNContactFamilyNameKey];</div><div class="line">        CNContactStore *store = [[CNContactStore alloc] init];</div><div class="line">        CNContact  *refetchedContact =  [store unifiedContactWithIdentifier:contact.identifier keysToFetch:keyFetch error:nil];</div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20160816154629703" alt="这里写图片描述"></p>
<hr>
<h1 id="ContactsUI"><a href="#ContactsUI" class="headerlink" title="ContactsUI"></a>ContactsUI</h1><p> 主要就是实现 <code>CNContactPickerDelegate</code>和数据的处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">- (void)contactPickerDidCancel:(CNContactPickerViewController *)picker&#123;</div><div class="line">    NSLog(@&quot;取消&quot;);</div><div class="line">&#125;</div><div class="line">/**</div><div class="line"> *  选中联系人时执行该方法</div><div class="line"> *</div><div class="line"> *  @param picker  联系人控制器</div><div class="line"> *  @param contact 联系人</div><div class="line"> */</div><div class="line">- (void)contactPicker:(CNContactPickerViewController *)picker didSelectContact:(CNContact *)contact&#123;</div><div class="line">    NSLog(@&quot;联系人的资料:%@&quot;,contact);</div><div class="line">    NSString *fullName = contact.familyName;</div><div class="line">    </div><div class="line">    NSArray&lt;CNLabeledValue *&gt; *phoneArray = contact.phoneNumbers;</div><div class="line">    for (CNLabeledValue *label in phoneArray) &#123;</div><div class="line"> </div><div class="line">        NSString *phone = label.label;</div><div class="line">        CNPhoneNumber *phoneNum = label.value;</div><div class="line">        NSString *code = phoneNum.stringValue;</div><div class="line">       </div><div class="line">        if ([label.label isEqualToString:CNLabelPhoneNumberMobile]) &#123;</div><div class="line">             NSLog(@&quot;%@手机号码是phone:%@---%@&quot;,fullName,phone,code);</div><div class="line">        &#125;</div><div class="line">        NSLog(@&quot;%@号码是phone:%@---%@&quot;,fullName,phone,code);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    NSString *name =  [CNContactFormatter stringFromContact:contact style:CNContactFormatterStyleFullName];</div><div class="line">     NSLog(@&quot;全名是---%@&quot;,name);</div><div class="line">    NSString *phoneName = [CNContactFormatter stringFromContact:contact style:CNContactFormatterStylePhoneticFullName];</div><div class="line">     NSLog(@&quot;号码全名是---%@&quot;,phoneName);</div><div class="line">     </div><div class="line">    NSArray&lt;CNLabeledValue *&gt; *postAddressArray = contact.postalAddresses;</div><div class="line">    for (CNLabeledValue *addressLabel in postAddressArray) &#123;</div><div class="line">        CNPostalAddress *address = addressLabel.value;</div><div class="line">        NSString *ad = [CNPostalAddressFormatter stringFromPostalAddress:address style:CNPostalAddressFormatterStyleMailingAddress];</div><div class="line">        NSLog(@&quot;地址是---%@&quot;,ad);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//选中属性时候执行</div><div class="line">- (void)contactPicker:(CNContactPickerViewController *)picker didSelectContactProperty:(CNContactProperty *)contactProperty &#123;</div><div class="line">    NSString *key = contactProperty.key;</div><div class="line">    NSString *value = contactProperty.value;</div><div class="line">    NSLog(@&quot;%@号码是phone:%@---&quot;,key,value);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>手机号码和邮箱的提取有点麻烦，需要多次判断，其他的没有什么难度。获取手机号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">NSArray&lt;CNLabeledValue *&gt; *phoneArray = contact.phoneNumbers;</div><div class="line">   for (CNLabeledValue *label in phoneArray) &#123;</div><div class="line">       NSString *phone = label.label;</div><div class="line">       CNPhoneNumber *phoneNum = label.value;</div><div class="line">       NSString *code = phoneNum.stringValue;</div><div class="line">       if ([label.label isEqualToString:CNLabelPhoneNumberMobile]) &#123;</div><div class="line">            NSLog(@&quot;%@手机号码是phone:%@---%@&quot;,fullName,phone,code);</div><div class="line">       &#125;</div><div class="line">       NSLog(@&quot;%@号码是phone:%@---%@&quot;,fullName,phone,code);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>首先是取到<code>CNLabeledValue</code>数组，然后遍历数组取出<code>CNPhoneNumber</code>。需要注意的是<code>CNPhoneNumber</code>并不包含是手机号，还是工作号这些标签。所以判断这个还是要依据<code>CNLabeledValue</code>的Label进行判断<code>[label.label isEqualToString:CNLabelPhoneNumberMobile]</code>。</p>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>作者: </span>
      <span>joyseedog</span>
    </p>
    <p class="copyright-item">
      <span>来源: </span>
      <a href="http://www.iseedog.com">http://www.iseedog.com</a>
    </p>
    <p class="copyright-item">
      <span>链接: </span>
      <a href="http://www.iseedog.com/2016/08/16/ios-contact/">http://www.iseedog.com/2016/08/16/ios-contact/</a>
    </p>

    <p class="copyright-item lincese">
      
      本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
    </p>
  </div>



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/iOS开发进阶/">iOS开发进阶</a>
            
              <a href="/tags/CNContacts/">CNContacts</a>
            
              <a href="/tags/CNContactsUI/">CNContactsUI</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2016/08/16/ios-alertcontroller/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">iOS开发进阶-UIAlertController使用</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2016/08/16/ios-tap/">
        <span class="next-text nav-default">iOS开发进阶-UITapGestureRecognizer使用技巧</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:joyseedog@email.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
  </span>
  
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2017

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">joyseedog</span>
  </span>
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  

  
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://www.iseedog.com/2016/08/16/ios-contact/';
        this.page.identifier = '2016/08/16/ios-contact/';
        this.page.title = 'iOS开发进阶-Contacts/ContactUI学习和使用';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//joyseedog.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>

  




    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.4.x"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.4.x"></script>

    
  </body>
</html>
